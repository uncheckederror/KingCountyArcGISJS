<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>WA Parcel Viewer</title>
    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>
    <!-- This will need to be updated as new versions are released. -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.15/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.17/"></script>
    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/FeatureLayer",
            "esri/layers/WebTileLayer",
            "esri/Basemap",
            "esri/widgets/Search",
            "esri/widgets/Search/LocatorSearchSource",
            "esri/tasks/Locator",
            "esri/layers/MapImageLayer"
        ], function (Map, MapView, FeatureLayer, WebTileLayer, Basemap, Search, LocatorSearchSource, Locator, MapImageLayer) {

            const kcParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.PIN"
                },
                maxScale: 0,
                minScale: 2500
            };

            const snocoParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.PARCEL_ID"
                },
                maxScale: 0,
                minScale: 2500
            };

            const pierceParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.TaxParcelNumber"
                },
                maxScale: 0,
                minScale: 2500
            };

            const thurstonParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.PARCEL_NO"
                },
                maxScale: 0,
                minScale: 2500
            };

            const wahkiakumParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.Property_ID"
                },
                maxScale: 0,
                minScale: 2500
            };

            const clarkParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.Property ID"
                },
                maxScale: 0,
                minScale: 2500
            };

            const islandParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.ParcelNo"
                },
                maxScale: 0,
                minScale: 2500
            };

            const sanJuanParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.PIN"
                },
                maxScale: 0,
                minScale: 2500
            };

            const yakimaParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.ASSESSOR_N"
                },
                maxScale: 0,
                minScale: 2500
            };

            const bentonParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.Parcel_ID"
                },
                maxScale: 0,
                minScale: 2500
            };

            const franklinParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.PARCELNUMBER"
                },
                maxScale: 0,
                minScale: 2500
            };

            const stateParcelslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 8,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.ORIG_PARCEL_ID"
                },
                maxScale: 0,
                minScale: 2500
            };

            const countyBoundarieslabelClass = {
                // autocasts as new LabelClass()
                symbol: {
                    type: "text", // autocasts as new TextSymbol()
                    color: "black",
                    font: {
                        // autocast as new Font()
                        family: "sans-serif",
                        size: 14,
                        weight: "lighter"
                    }
                },
                labelPlacement: "center-along",
                labelExpressionInfo: {
                    expression: "$feature.JURISDICT_NM"
                },
                maxScale: 2500,
                minScale: 0
            };

            // Add the custom basemap to the map.
            var map = new Map({
                basemap: "osm"
            });

            // King County parcels as a Feature layer.
            var kingCountyParcels = new FeatureLayer({
                url: "https://gisdata.kingcounty.gov/arcgis/rest/services/OpenDataPortal/property__parcel_area/MapServer/439/",
                opacity: 0.8,
                labelingInfo: [kcParcelslabelClass],
                maxScale: 0
            });

            var symbol = {
                type: "simple",  // autocasts as new SimpleRenderer()
                symbol: {
                    type: "simple-fill",  // autocasts as new SimpleMarkerSymbol()
                    size: 6,
                    color: "transparent",
                    outline: {  // autocasts as new SimpleLineSymbol()
                        width: 0.5,
                        color: "black"
                    }
                }
            };

            kingCountyParcels.renderer = symbol;

            var kcTemplate = {
                // autocasts as new PopupTemplate()
                title: "<a target='_blank noreferrer' href='https://blue.kingcounty.com/Assessor/eRealProperty/Dashboard.aspx?ParcelNbr={PIN}'>{PIN}</a>",
            };

            kingCountyParcels.popupTemplate = kcTemplate;

            // Snohomish parcels as a Feature layer.
            var snocoParcels = new FeatureLayer({
                url: "https://gismaps.snoco.org/securegis/rest/services/cadastral/tax_parcels/MapServer",
                opacity: 0.8,
                labelingInfo: [snocoParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            snocoParcels.renderer = symbol;

            var snocoTemplate = {
                // autocasts as new PopupTemplate()
                title: "{PARCEL_ID}",
            };

            snocoParcels.popupTemplate = snocoTemplate;

            // Pierce County parcels as a Feature layer.
            var pierceParcels = new FeatureLayer({
                url: "https://services2.arcgis.com/1UvBaQ5y1ubjUPmd/arcgis/rest/services/Tax_Parcels/FeatureServer/0/",
                opacity: 0.8,
                labelingInfo: [pierceParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            pierceParcels.renderer = symbol;

            var pierceTemplate = {
                // autocasts as new PopupTemplate()
                title: "{TaxParcelNumber}",
            };

            pierceParcels.popupTemplate = pierceTemplate;

            // Thurston county parcels as a Feature layer.
            var thurstonParcels = new FeatureLayer({
                url: "https://map.co.thurston.wa.us/arcgis/rest/services/Thurston/Thurston_Parcels/FeatureServer/0/",
                opacity: 0.8,
                labelingInfo: [thurstonParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            thurstonParcels.renderer = symbol;

            var thurstonTemplate = {
                // autocasts as new PopupTemplate()
                title: "{PARCEL_NO}",
            };

            thurstonParcels.popupTemplate = thurstonTemplate;

            // Wahkiakum county parcels as a Feature layer.
            var wahkiakumParcels = new FeatureLayer({
                url: "https://services5.arcgis.com/SQaKrZ90pTH1GKNW/ArcGIS/rest/services/Parcels_11_10_2020/FeatureServer",
                opacity: 0.8,
                labelingInfo: [wahkiakumParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            wahkiakumParcels.renderer = symbol;

            var wahkiakumTemplate = {
                // autocasts as new PopupTemplate()
                title: "{Property_ID}",
            };

            wahkiakumParcels.popupTemplate = wahkiakumTemplate;

            // Clark county parcels as a Feature layer.
            var clarkParcels = new FeatureLayer({
                url: "https://services2.arcgis.com/ylxwjFBdCPBzP16d/arcgis/rest/services/TaxlotsPublic/FeatureServer/0/query?outFields=*&where=1%3D1",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            clarkParcels.renderer = symbol;

            // Island county parcels as a Feature layer.
            var islandParcels = new FeatureLayer({
                url: "https://services6.arcgis.com/Q2crTJYujvn27IJC/arcgis/rest/services/Parcels/FeatureServer/0/",
                opacity: 0.8,
                labelingInfo: [islandParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            islandParcels.renderer = symbol;

            var islandTemplate = {
                // autocasts as new PopupTemplate()
                title: "{Property_ID}",
            };

            islandParcels.popupTemplate = islandTemplate;

            // San Juan county parcels as a Feature layer.
            var sanJuanParcels = new FeatureLayer({
                url: "https://gis.sanjuanco.com/arcgis/rest/services/OpenData/Parcels/MapServer/0/",
                opacity: 0.8,
                labelingInfo: [sanJuanParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            sanJuanParcels.renderer = symbol;

            var sanJuanTemplate = {
                // autocasts as new PopupTemplate()
                title: "{PIN}",
            };

            sanJuanParcels.popupTemplate = sanJuanTemplate;

            // Yakima county parcels as a Feature layer.
            var yakimaParcels = new FeatureLayer({
                url: "https://services3.arcgis.com/9Qz94N8Zml9hnG84/arcgis/rest/services/Parcels/FeatureServer/0/",
                opacity: 0.8,
                labelingInfo: [yakimaParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            yakimaParcels.renderer = symbol;

            var yakimaTemplate = {
                // autocasts as new PopupTemplate()
                title: "{ASSESSOR_N}",
            };

            yakimaParcels.popupTemplate = yakimaTemplate;

            // Benton county parcels as a Feature layer.
            var bentonParcels = new FeatureLayer({
                url: "https://services7.arcgis.com/NURlY7V8UHl6XumF/arcgis/rest/services/Parcels_and_Assess/FeatureServer/",
                opacity: 0.8,
                labelingInfo: [bentonParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            bentonParcels.renderer = symbol;

            var bentonTemplate = {
                // autocasts as new PopupTemplate()
                title: "{Parcel_ID}",
            };

            bentonParcels.popupTemplate = bentonTemplate;

            // Benton county parcels as a Feature layer.
            var franklinParcels = new FeatureLayer({
                url: "https://gisportal.franklin.co.franklin.wa.us:6443/arcgis/rest/services/parcels/MapServer/",
                opacity: 0.8,
                labelingInfo: [franklinParcelslabelClass],
                maxScale: 0,
                minScale: 200000
            });

            franklinParcels.renderer = symbol;

            var franklinTemplate = {
                // autocasts as new PopupTemplate()
                title: "{PARCELNUMBER}",
            };

            franklinParcels.popupTemplate = bentonTemplate;

            // Parcels from the state of WA
            var stateParcels = new FeatureLayer({
                url: "https://services.arcgis.com/jsIt88o09Q0r1j8h/arcgis/rest/services/Current_Parcels_2020/FeatureServer/0/",
                opacity: 0.8,
                labelingInfo: [stateParcelslabelClass],
                maxScale: 0
            });

            stateParcels.renderer = symbol;

            var stateTemplate = {
                // autocasts as new PopupTemplate()
                title: "{ORIG_PARCEL_ID}",
            };

            stateParcels.popupTemplate = stateTemplate;

            // Parcels from Mason county as a feature layer.
            // Because it's an image layer we can't do custom styling or popups.
            var masonParcels = new MapImageLayer({
                url: "https://gis.co.mason.wa.us/arcgis/rest/services/MasonCoSite/TaxParcels/MapServer",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            var jeffersonParcels = new MapImageLayer({
                url: "https://gisweb.jeffcowa.us/server/rest/services/LandRecords/PublicTaxParcels/MapServer/",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            var clallamParcels = new MapImageLayer({
                url: "https://websrv19.clallam.net/arcgis/rest/services/web/ParcelMap/MapServer",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            var cowlitzParcels = new MapImageLayer({
                url: "https://www.cowlitzinfo.net/arcgis/rest/services/WSPublic/ParcelsDark/MapServer",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            var lewisParcels = new MapImageLayer({
                url: "https://arcgis.lewiscountywa.gov/arcgispublic/rest/services/Public/BaseLayers/MapServer/",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            var skagitParcels = new MapImageLayer({
                url: "https://www.skagitcounty.net/gispublic/rest/services/Assessor/PropertyInfoWebMap/MapServer/",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            var whatcomParcels = new MapImageLayer({
                url: "https://gis.whatcomcounty.us/arcgis/rest/services/Applications/PACSGIS_Viewer/MapServer",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            var klickitatParcels = new MapImageLayer({
                url: "http://imap.klickitatcounty.org/arcgis/rest/services/Klickitat/Klickitat_TOC_Dynamic/MapServer",
                opacity: 0.8,
                maxScale: 0,
                minScale: 200000
            });

            // Parcels from the state of WA
            var countyBoundaries = new FeatureLayer({
                url: "https://gis.dnr.wa.gov/site3/rest/services/Public_Boundaries/WADNR_PUBLIC_Cadastre_OpenData/MapServer/11/",
                opacity: 0.8,
                labelingInfo: [countyBoundarieslabelClass],
                maxScale: 2500,
                minScale: 0
            });

            countyBoundaries.renderer = symbol;

            var countiesTemplate = {
                // autocasts as new PopupTemplate()
                title: "{JURISDICT_NM}",
            };

            countyBoundaries.popupTemplate = countiesTemplate;

            // Add the layers to the map in a specific order.
            //map.add(stateParcels);
            map.add(franklinParcels);
            map.add(bentonParcels);
            map.add(yakimaParcels);
            map.add(klickitatParcels);
            map.add(sanJuanParcels);
            map.add(whatcomParcels);
            map.add(skagitParcels);
            map.add(islandParcels);
            map.add(lewisParcels);
            map.add(clarkParcels);
            map.add(cowlitzParcels);
            map.add(wahkiakumParcels);
            map.add(clallamParcels);
            map.add(jeffersonParcels);
            map.add(masonParcels);
            map.add(thurstonParcels);
            map.add(snocoParcels);
            map.add(pierceParcels);
            map.add(kingCountyParcels);
            map.add(countyBoundaries);

            // Create a view of the map and render it to the DOM.
            var view = new MapView({
                container: "viewDiv",
                map: map,
                center: [-121.0, 47.61], // longitude, latitude.
                zoom: 6 // Parcels aren't visible above zoom level 16.
            });

            view.constraints = {
                minScale: 2500000,  // User cannot zoom out beyond a scale of 1:500,000
                maxScale: 0,  // User can overzoom tiles
                rotationEnabled: false  // Disables map rotation
            };

            var locatorSymbol = {
                type: "simple-marker",  // autocasts as new SimpleMarkerSymbol()
                style: "circle",
                color: "red",
                size: "20px",  // pixels
                outline: {  // autocasts as new SimpleLineSymbol()
                    color: [255, 255, 255],
                    width: 1  // points
                }
            };

            var searchWidget = new Search({
                view: view,
                allPlaceholder: "Parcel Number or Address",
                sources: [
                    // Adds the Four County composite locator.
                    {
                        locator: new Locator({ url: "https://gismaps.kingcounty.gov/arcgis/rest/services/Address/FourCounty_composite_locator/GeocodeServer" }),
                        singleLineFieldName: "SingleLine",
                        name: "All Counties",
                        placeholder: "Address with City and Zip or a Parcel Number",
                        resultSymbol: locatorSymbol,
                        maxResults: 3,
                        maxSuggestions: 6,
                        suggestionsEnabled: true,
                        minSuggestCharacters: 3,
                        popupEnabled: false,
                        zoomScale: 0
                    }
                ],
                // Remove the ESRI world geocoder.
                includeDefaultSources: false
            });

            // Adds the search widget to the top right corner of the view
            view.ui.add(
                searchWidget,
                "top-right"
            );

            searchWidget.on("search-complete", function (event) {
                // The results are stored in the event Object[]
                console.log("Results of the search: ", event);
                console.log(event.results[0].results[0].extent.center.latitude);
                console.log(event.results[0].results[0].extent.center.longitude);
                console.log(map.layers);

            });


        });
    </script>
</head>

<body>
    <div id="viewDiv"></div>
</body>

</html>